(function(global){"use strict";function require(e){e&&e.length>2&&"."===e[0]&&"/"===e[1]&&(e=e.slice(2));var t=$SIMSAW_MODULE[e],r=null;if("function"==typeof t){var n={};$SIMSAW_MODULE[e]=n,t(n),r=n}else{if("object"!=typeof t)throw"Unknown module "+e;r=t}return r}var $SIMSAW_MODULE={};$SIMSAW_MODULE.SimsawBaas=function(e){function t(e){var t=0;for(t;e.length>t;t++)if(e[t].supportsCurrentRuntime())return e[t];throw Error("Unsupported browser - no suitable providers are available.")}var r=require("Extensions"),n=require("Validate"),o=require("Promises"),s={},i=null,a=/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})(?:\.(\d*))?Z$/,u=!JSON.stringify(new Date(100)).match(/\.100Z"$/);e.async=function(e){return function(){var t=this,n=arguments;return new o.Promise(function(o,s){var i=function(e){e?s(e):o.apply(null,Array.prototype.slice.call(arguments,1))};Array.prototype.push.call(n,i);try{e.apply(t,n)}catch(a){i(r.createError(a))}})}},e.addToClientNamespace=function(e){var t=global.Simsaw=global.Simsaw||{},r=null;for(r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},e.getSetting=function(e){return s[e]},e.setSetting=function(e,t){s[e]=t},e.webRequest=function(e,r){return i||(i=t([require("AjaxTransport"),require("IframeTransport")])),i.performRequest(e,r)},e.toJson=function(e){return JSON.stringify(e,function(e,t){if(u&&this&&r.isDate(this[e])){var n=this[e].getMilliseconds(),o=(n+1e3+"").substring(1);t=t.replace(a,function(e,t){return t+"."+o+"Z"})}return t})},e.tryParseIsoDateString=function(e){n.isString(e);var t=a.exec(e);if(t){var r=t[1],o=t[2]||"0",s=Math.round(1e3*Number("0."+o));r=r.replace(/\-/g,"/").replace("T"," ");var i=Date.parse(r+" UTC");if(!isNaN(i))return new Date(i+s)}return null},e.mutateOnSave=!1},$SIMSAW_MODULE.BaasClient=function(e){function t(e,t){u.isString(e,"applicationId"),this.baasUrl=(t||"http://baas.simsaw.com")+"/api/baas/"+e,this.authToken=s("authToken"),this.BaasData=function(e){return u.isString(e,"collectionName"),u.notNullOrEmpty(e,"collectionName"),new f(e,this)}}function r(e){for(var t,r={},n=/\+/g,o=/([^&;=]+)=?([^&;]*)/g,s=function(e){return decodeURIComponent(e.replace(n," "))},i=e.substring(1);t=o.exec(i);)r[s(t[1])]=s(t[2]);return r}function n(){var e=null,t=l.Config_AppIdKey,r=c.getSetting(t);return a.isNull(r)?(e=a.createUniqueInstallationId(),c.setSetting(t,e)):e=r,e}function o(e,t,r){var n=new Date,o="";r&&(n.setTime(n.getTime()+1e3*60*60*24*r),o="; expires="+n.toGMTString()),document.cookie=e+"="+t+o+"; path=/"}function s(e){var t=e+"=",r=document.cookie.split(";"),n=0;for(n;r.length>n;n++){for(var o=r[n];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t)){var s=o.substring(t.length,o.length);return s}}return null}function i(e){createCookie(e,"",-1)}var a=require("Extensions"),u=require("Validate"),l=require("Resources").Messages,c=require("SimsawBaas"),f=require("BaasData").BaasData;e.BaasClient=t,c.addToClientNamespace({BaasClient:t}),t.appInstallId=n(),t.userAgent=null,t.prototype.request=function(e,r,n,o){u.isString(e,"method"),u.notNullOrEmpty(e,"method"),u.isString(r,"relativePath"),u.notNull(r,"relativePath"),u.notNull(o,"callback");var s={type:e.toUpperCase()};s.url=this.baasUrl+"/"+r,s.headers={},s.headers[l.Request_Header_AppInstallId]=t.appInstallId,this.authToken&&(s.headers[l.Request_Header_Auth]=this.authToken),a.isNull(t.userAgent)||(s.headers[l.Request_Header_UserAgent]=t.userAgent),a.isNull(n)?s.data=null:(s.headers["Content-Type"]="application/json",s.data=a.toJson(n));var i=function(e,t){a.isNull(e)?!a.isNull(t)&&(t.status>=400||0===t.status)&&(e=a.createError(null,t),t=null):e=a.createError(e),o(e,t)};c.webRequest(s,i)},t.prototype.logout=function(){this.authToken=null,i("authToken")},t.prototype.setAccessToken=function(e){var t=r(e),n=t.token_type+" "+t.access_token;this.authToken=n,o("authToken",n,7)}},$SIMSAW_MODULE.BaasData=function(e){function t(e,t){this.getCollectionName=function(){return e},this.getBaasClient=function(){return t},this.settings=null;var r=this;t.request("get","data/"+e+"/permissions",null,function(e,t){e?console.log(e):r.settings=t})}function r(e,t){if(!n.isNull(e)&&!n.isNull(t)){var r=null;for(r in t)e[r]=t[r]}return e}var n=require("Extensions"),o=require("Validate"),s=require("Resources").Messages,i=require("SimsawBaas"),a="_id";e.BaasData=t,t.prototype.find=i.async(function(e,t,r){e&&"function"==typeof e?(r=e,e=null,t=null):t&&"function"==typeof t&&(r=t,t=null),e=e||{},t=t||{},o.notNull(r,"callback");var s=this.getCollectionName(),i="data/"+s+"/find";this.getBaasClient().request("POST",i,{query:e,projection:t},function(e,t){e?r(e,null):r(null,n.fromJson(t.responseText).d)})}),t.prototype.findById=i.async(function(e,t,r){t&&"function"==typeof t&&(r=t,t={}),o.notNull(e,a),o.notNull(r,"callback"),this.find({_id:""+e},t,function(e,t){r(e,t[0])})}),t.prototype.insert=i.async(function(e,t){if(o.notNull(e,"model"),o.notNull(t,"callback"),e[a])throw n.format(s.Error_Data_Insert_IdAlreadySet,a);var u="data/"+this.getCollectionName();this.getBaasClient().request("POST",u,e,function(o,s){if(o)t(o,null);else{var a=n.fromJson(s.responseText);i.mutateOnSave&&(a=r(e,a)),t(null,a)}})}),t.prototype.update=i.async(function(e,t){o.notNull(e,"model"),o.notNull(e[a],"model."+a),o.notNull(t,"callback");var s="data/"+this.getCollectionName()+"/"+(""+e[a]);this.getBaasClient().request("PUT",s,e,function(o,s){if(o)t(o,null);else{var a=n.fromJson(s.responseText);i.mutateOnSave&&(a=r(e,a)),t(null,a)}})}),t.prototype.remove=i.async(function(e,t){o.notNull(e,"item id"),o.isString(e,"item id"),o.notNull(t,"callback"),this.getBaasClient().request("DELETE","data/"+this.getCollectionName()+"/"+e,null,function(e){t(e)})})},$SIMSAW_MODULE.Resources=function(e){e.Messages={Config_AppIdKey:"SS.InstallId",Request_Header_Auth:"authorization",Request_Header_AppInstallId:"X-SS-BAAS-INSTALL-ID",Request_Header_UserAgent:"User-Agent",Error_Val_Not_Null:"{0} cannot be null.",Error_Val_Not_Null_Or_Empty:"{0} cannot be null or empty.",Error_Val_Type_Check:"{0} is expected to be a value of type {1}, not {2}.",Error_Val_Length_Unexpected:"{0} is expected to have length {1}, not {2}.",Error_Val_Auth_Provide_Not_Supported:"Authentication provider not supported. Please specify one of {0}.",Error_Default:"Unexpected failure.",Error_Conn_Failure:"Unexpected connection failure.",Error_Data_Insert_IdAlreadySet:"Cannot insert if the {0} member is already set."}},$SIMSAW_MODULE.AjaxTransport=function(e){e.name="AjaxTransport",e.supportsCurrentRuntime=function(){var e=typeof global.XMLHttpRequest,t="undefined"!==(new global.XMLHttpRequest).withCredentials;return"undefined"!==e&&t},e.performRequest=function(e,t){var r=e.headers||{},n=e.url.replace(/#.*$/,""),o=e.type?e.type.toUpperCase():"GET",s=new global.XMLHttpRequest;s.onreadystatechange=function(){4===s.readyState&&t(null,s)},s.open(o,n);var i=null;for(i in r)e.headers.hasOwnProperty(i)&&s.setRequestHeader(i,e.headers[i]);s.send(e.data)}},$SIMSAW_MODULE.IframeTransport=function(e){function t(e){e&&1223===e.status&&(e.status=204)}function r(e,t){var r=s[e];r||(r=s[e]=new n.Promise(function(t){var r=document.createElement("iframe"),n=o.getOriginRoot(window.location.href),s=function(){t(r)};r.addEventListener?r.addEventListener("load",s,!1):r.attachEvent("onload",s),r.src=e+"/crossdomain/bridge?origin="+encodeURIComponent(n),r.setAttribute("width",0),r.setAttribute("height",0),r.style.display="none",global.document.body.appendChild(r)})),r.then(t)}var n=require("Promises"),o=require("PostMessageExchange"),s=[],i=o.instance;e.name="IframeTransport",e.supportsCurrentRuntime=function(){var e=typeof global.postMessage;return"undefined"!==e},e.performRequest=function(e,n){var s=o.getOriginRoot(e.url);r(s,function(r){var o={type:e.type,url:e.url,headers:e.headers,data:e.data};i.request(r.contentWindow,o,s).then(function(e){t(e),n(null,e)},function(e){n(e,null)})})}},$SIMSAW_MODULE.PostMessageExchange=function(e){function t(){var e=this;e.lastMessageId=0,e.hasListener=!1,e.pendingMessages={}}function r(e){var t=n(e),r=t.port?""+t.port:null,o="http:"===t.protocol&&"80"===r||"https:"===t.protocol&&"443"===r,s=r&&!o?":"+r:"";return t.protocol+"//"+t.hostname+s}function n(e){var t=global.document.createElement("a");return t.href=e,t}var o=require("Promises"),s=3e5;t.prototype.request=function(e,t,r){var n=this,i=++n.lastMessageId,a={messageId:i,contents:t};return n.ensureHasListener(),new o.Promise(function(t,o){n.pendingMessages[i]={messageId:i,complete:t,error:o,targetWindow:e,origin:r},n.pendingMessages[i].timeoutId=global.setTimeout(function(){var e=n.pendingMessages[i];e&&(delete n.pendingMessages[i],e.error({status:0,statusText:"Timeout",responseText:null}))},s),e.postMessage(JSON.stringify(a),r)})},t.prototype.ensureHasListener=function(){if(!this.hasListener){this.hasListener=!0;var e=this,t=function(){e.handleMessage.apply(e,arguments)};window.addEventListener?window.addEventListener("message",t,!1):window.attachEvent("onmessage",t)}},t.prototype.handleMessage=function(e){var t=this.tryDeserializeMessage(e.data),n=t&&t.messageId,o=n&&this.pendingMessages[n],s=o&&o.targetWindow===e.source&&o.origin===r(e.origin);s&&(global.clearTimeout(o.timeoutId),delete this.pendingMessages[n],o.complete(t.contents))},t.prototype.tryDeserializeMessage=function(e){if(!e||"string"!=typeof e)return null;try{return JSON.parse(e)}catch(t){return null}},e.instance=new t,e.getOriginRoot=r},$SIMSAW_MODULE.Extensions=function(e){var t=require("Validate"),r=require("Resources").Messages,n=require("SimsawBaas"),o=e;e.isNull=function(e){return null===e||void 0===e},e.isNullOrEmpty=function(e){return o.isNull(e)||0===e.length},e.format=function(e){var r=e;if(t.isString(r,"message"),!o.isNullOrEmpty(r)&&arguments.length>1){var n=1;for(n;arguments.length>n;n++)for(var s="{"+(n-1)+"}";-1!==r.indexOf(s);)r=r.replace(s,arguments[n])}return r},e.isObject=function(e){return o.isNull(e)||"object"==typeof e&&!o.isDate(e)},e.isString=function(e){return o.isNull(e)||"string"==typeof e},e.isBool=function(e){return!o.isNull(e)&&"boolean"==typeof e},e.isDate=function(e){return!o.isNull(e)&&e.constructor===Date},e.isNumber=function(e){return!o.isNull(e)&&"number"==typeof e},e.toJson=function(e){return n.toJson(e)},e.fromJson=function(r){return t.isString(r,"value"),JSON.parse(r,function(t,r){if(o.isString(r)&&!o.isNullOrEmpty(r)){var n=e.tryParseIsoDateString(r);if(!o.isNull(n))return n}return r})},e.createUniqueInstallationId=function(){var e=function(e){return"0000".substring(e.length)+e},t=function(){return e(Math.floor(65536*Math.random()).toString(16))};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},e.trimEnd=function(e,r){t.isString(e,"text"),t.notNull(e,"text"),t.isString(r,"ch"),t.notNullOrEmpty("ch","ch"),t.length(r,1,"ch");for(var n=e.length-1;n>=0&&e[n]===r;)n--;return n>=0?e.substr(0,n+1):""},e.trimStart=function(e,r){t.isString(e,"text"),t.notNull(e,"text"),t.isString(r,"ch"),t.notNullOrEmpty(r,"ch"),t.length(r,1,"ch");for(var n=0;e.length>n&&e[n]===r;)n++;return e.length>n?e.substr(n,e.length-n):""},e.tryParseIsoDateString=function(e){return n.tryParseIsoDateString(e)},e.createError=function(e,t){var n={message:r.Error_Default};if(n.toString=function(){return n.message},t)if(n.request=t,0===t.status)n.message=r.Error_Conn_Failure;else try{var s=JSON.parse(t.responseText);n.message=s.err||s.error||s.description||t.statusText||r.Error_Default}catch(i){n.message=t.statusText||r.Error_Default}else o.isString(e)&&!o.isNullOrEmpty(e)?n.message=e:o.isNull(e)||(n.exception=e,n.message=e.message||e.description||r.Error_Default);return n}},$SIMSAW_MODULE.Validate=function(e){var t=require("Extensions"),r=require("Resources").Messages;e.notNull=function(e,n){if(t.isNull(e))throw t.format(r.Error_Val_Not_Null,n||"Value")},e.notNullOrEmpty=function(e,n){if(t.isNullOrEmpty(e))throw t.format(r.Error_Val_Not_Null_Or_Empty,n||"Value")},e.isDate=function(n,o){if(e.notNull(n,o),!t.isDate(n))throw t.format(r.Error_Val_Type_Check,o||"Value","Date",typeof n)},e.isString=function(e,n){if(!t.isString(e))throw t.format(r.Error_Val_Type_Check,n||"Value","string",typeof e)},e.isObject=function(e,n){if(!t.isObject(e))throw t.format(r.Error_Val_Type_Check,n||"Value","object",typeof e)},e.length=function(n,o,s){if(e.notNull(n,s),e.isInteger(o,"length"),n.length!==o)throw t.format(r.Error_Val_Length_Unexpected,s||"Value",o,n.length)},e.isInteger=function(n,o){if(e.notNull(n,o),e.isNumber(n,o),parseInt(n,10)!==parseFloat(n))throw t.format(r.Validate_TypeCheck_Error,o||"Value","number",typeof n)},e.isNumber=function(n,o){if(e.notNull(n,o),!t.isNumber(n))throw t.format(r.Validate_TypeCheck_Error,o||"Value","Number",typeof n)}},$SIMSAW_MODULE.Promises=function(e){(function(e){function t(e){this.callbackFrames=[],this.resolutionState=null,this.resolutionValueOrError=null,this.resolveSuccess=n(this.resolveSuccess,this),this.resolveError=n(this.resolveError,this),e&&e(this.resolveSuccess,this.resolveError)}var r={success:{},error:{}},n=function(e,t){return function(){e.apply(t,arguments)}},o=function(e){return e&&"function"==typeof e.then};t.prototype.then=function(e,r){var n={success:e,error:r,chainedPromise:new t};return this.resolutionState?this.invokeCallback(n):this.callbackFrames.push(n),n.chainedPromise},t.prototype.resolveSuccess=function(e){this.resolve(r.success,e)},t.prototype.resolveError=function(e){this.resolve(r.error,e)},t.prototype.resolve=function(e,t){if(!this.resolutionState){this.resolutionState=e,this.resolutionValueOrError=t;var r=0,n=this.callbackFrames.length;for(r;n>r;r++)this.invokeCallback(this.callbackFrames[r])}},t.prototype.invokeCallback=function(e){var t=this.resolutionState===r.success?e.success:e.error;"function"==typeof t?setTimeout(n(function(){var n,s,i=!0;try{n=t(this.resolutionValueOrError),s=r.success}catch(a){i=!1,n=a,s=r.error}i&&o(n)?n.then(e.chainedPromise.resolveSuccess,e.chainedPromise.resolveError):e.chainedPromise.resolve(s,n)},this),1):e.chainedPromise.resolve(this.resolutionState,this.resolutionValueOrError)},t.prototype.done=function(e,t){return this.then(e,t).then(null,function(e){setTimeout(function(){throw Error(e)},1)}),void 0},e.Promise=t})(e)},$SIMSAW_MODULE.JSON2=function(exports){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var r,n,o,s,i,a=gap,u=t[e];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(e)),"function"==typeof rep&&(u=rep.call(t,e,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?u+"":"null";case"boolean":case"null":return u+"";case"object":if(!u)return"null";if(gap+=indent,i=[],"[object Array]"===Object.prototype.toString.apply(u)){for(s=u.length,r=0;s>r;r+=1)i[r]=str(r,u)||"null";return o=0===i.length?"[]":gap?"[\n"+gap+i.join(",\n"+gap)+"\n"+a+"]":"["+i.join(",")+"]",gap=a,o}if(rep&&"object"==typeof rep)for(s=rep.length,r=0;s>r;r+=1)"string"==typeof rep[r]&&(n=rep[r],o=str(n,u),o&&i.push(quote(n)+(gap?": ":":")+o));else for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(o=str(n,u),o&&i.push(quote(n)+(gap?": ":":")+o));return o=0===i.length?"{}":gap?"{\n"+gap+i.join(",\n"+gap)+"\n"+a+"}":"{"+i.join(",")+"}",gap=a,o}}if("object"!=typeof JSON){JSON={},"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,r){var n;if(gap="",indent="","number"==typeof r)for(n=0;r>n;n+=1)indent+=" ";else"string"==typeof r&&(indent=r);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var r,n,o=e[t];if(o&&"object"==typeof o)for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(n=walk(o,r),void 0!==n?o[r]=n:delete o[r]);return reviver.call(e,t,o)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}},require("JSON2"),require("BaasClient")})(this);